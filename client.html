<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="UTF-8">
	<title>RPG Battle Test</title>
</head>

<body>
	<h1>Multiplayer RPG Test</h1>
	<div>
		<label>Name: <input type="text" id="name" /></label><br />
		<label>Class:
			<select id="class">
				<option value="Warrior">Warrior</option>
				<option value="Mage">Mage</option>
				<option value="Healer">Healer</option>
			</select>
		</label><br />
		<label>Party ID: <input type="text" id="party" value="default" /></label><br />
		<button onclick="connect()">Join Game</button>
	</div>

	<hr>
	<div id="game" style="display:none;">
		<h3 id="status">Waiting...</h3>
		<button onclick="sendAction('fight')">Fight</button>
		<button onclick="sendAction('magic')">Magic</button>
		<button onclick="sendAction('item')">Item</button>
	</div>

	<pre id="log"></pre>

	<script>
		let ws;

		function connect() {
			const name = document.getElementById("name").value;
			const cls = document.getElementById("class").value;
			const party = document.getElementById("party").value;

			ws = new WebSocket("ws://localhost:8080/ws");

			ws.onopen = () => {
				log("Connected.");
				ws.send(JSON.stringify({
					type: "join_party",
					data: {partyId: party, name: name, class: cls}
				}));
				document.getElementById("game").style.display = "block";
			};

			ws.onmessage = (event) => {
				const msg = JSON.parse(event.data);
				log(`Received: ${JSON.stringify(msg, null, 2)}`);

				if (msg.type === "turn_start") {
					document.getElementById("status").innerText = `It's ${msg.data.name}'s turn`;
				}

				if (msg.type === "battle_start") {
					document.getElementById("status").innerText = `Battle started!`;
				}
			};

			ws.onclose = () => log("Disconnected.");
		}

		function sendAction(action) {
			ws.send(JSON.stringify({
				type: "player_action",
				data: {actionType: action}
			}));
		}

		function log(msg) {
			const pre = document.getElementById("log");
			pre.textContent += msg + "\n";
		}
	</script>
</body>

</html>
